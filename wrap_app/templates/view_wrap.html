{% extends 'base.html' %}
{% load static %}

{% block content %}
<div id="wrapper">

    <!-- Welcome Slide with Flavor Text -->
    <section class="slide" id="intro-section">
        <div class="slide-content">
            <h2>Get Ready to Discover Your Spotify Wrap!</h2>
            <p>It's been an epic year of music, and now it's time to relive the best moments. Are you ready to see your top songs, artists, and albums of the year?</p>
            <p>Hang tight, your personal Spotify Wrap is coming up next!</p>
        </div>
    </section>

    <!-- Welcome Section -->
    <section class="slide" id="welcome-section">
        <div class="slide-content">
            <h2>Welcome, {{ wrap.spotify_username }}</h2>
            <p>Spotify Product: {{ wrap.product }}</p>
            <p>Creation Date: {{ wrap.created_at }}</p>
            <p>Wrap Time Range: {{ wrap.time_range }}</p>
        </div>
    </section>

    <!-- Top Song Section -->
    <section class="slide" id="top-song">
        <div class="slide-content">
            <h2>Your Top Song</h2>
            {% if wrap.top_song %}
                <strong>**Playing Song (Feature Deprecated)**</strong>
                <p>Title: {{ wrap.top_song.title }}</p>
                <p>Artist: {{ wrap.top_song.artist }}</p>
                <p>Album: {{ wrap.top_song.album }}</p>
                {% if wrap.top_song.preview_url %}
                    <audio controls>
                        <source src="{{ wrap.top_song.preview_url }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                {% endif %}
            {% else %}
                <p>No data available for top song.</p>
            {% endif %}
            {% if wrap.top_song.image_url %}
                <img src="{{ wrap.top_song.image_url }}" alt="Image of {{ wrap.top_song.artist }}" width="150" style="border:5px solid #1DB954;">
            {% endif %}
        </div>
    </section>

    <!-- Top Artists Section -->
    <section class="slide" id="top-artists">
        <div class="slide-content">
            <h2>Top 3 Artists</h2>
            {% if wrap.top_artists %}
                <ol style="display: flex; padding: 0;">
                    {% for artist in wrap.top_artists %}
                        <li style="margin: 10px; text-align: center;">
                            <h4>{{ artist.name }}</h4>
                            {% if artist.genre %}
                                <p>Genre: {{ artist.genre }}</p>
                            {% endif %}
                            {% if artist.image_url %}
                                <img src="{{ artist.image_url }}" alt="Image of {{ artist.name }}" width="150" style="border:5px solid #1DB954;">
                            {% endif %}
                        </li>
                    {% endfor %}
                </ol>
            {% else %}
                <p>No data available for top artists.</p>
            {% endif %}
        </div>
    </section>

    <!-- Most Listened Genre Section -->
    <section class="slide" id="listened-genre">
        <div class="slide-content">
            <h2>Most Listened Genre</h2>
            {% if wrap.listened_genre %}
                <p>{{ wrap.listened_genre }}</p>
            {% else %}
                <p>No data available for most listened genre.</p>
            {% endif %}
        </div>
    </section>

    <!-- Top Album Section -->
    <section class="slide" id="top-album">
        <div class="slide-content">
            <h2>Top Album</h2>
            {% if wrap.top_album %}
                <p>Album Name: {{ wrap.top_album.name }}</p>
                <p>Artist: {{ wrap.top_album.artist }}</p>
            {% else %}
                <p>No data available for top album.</p>
            {% endif %}
            {% if wrap.top_album.image_url %}
                <img src="{{ wrap.top_album.image_url }}" alt="Image of {{ wrap.top_album.artist }}" width="150" style="border:5px solid #1DB954;">
            {% endif %}
        </div>
    </section>

    <!-- Special Message Section -->
    <section class="slide" id="special-message">
        <div class="slide-content">
            <h2>Special Message</h2>
            {% if wrap.special_message %}
                <p>{{ wrap.special_message }}</p>
            {% else %}
                <p>No special message available.</p>
            {% endif %}
        </div>
    </section>

    <!-- Top Tracks from Most Listened Artist Section -->
    <section class="slide" id="top-artist-tracks">
        <div class="slide-content">
            {% if wrap.most_listened_artist %}
                <h2>Top Tracks from {{ wrap.most_listened_artist.name }}</h2>
                {% if wrap.top_artist_tracks %}
                    <ul class="tracks-grid">
                        {% for track in wrap.top_artist_tracks %}
                            <li>
                                {% if track.image_url %}
                                    <img src="{{ track.image_url }}" alt="Album cover for {{ track.title }}" style="max-width: 150px; border:5px solid #1DB954;">
                                {% endif %}
                                <p>Title: {{ track.title }}</p>
                                <p>Album: {{ track.album }}</p>
                                {% if track.preview_url %}
                                    <audio controls>
                                        <source src="{{ track.preview_url }}" type="audio/mpeg">
                                        Your browser does not support the audio element.
                                    </audio>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No data available for top tracks of {{ wrap.most_listened_artist.name }}.</p>
                {% endif %}
            {% else %}
                <p>No data available for most listened artist.</p>
            {% endif %}
        </div>
    </section>

    <!-- Gemini Recommendations Section -->
    <section class="slide" id="gemini">
        <div class="slide-content">
            {% if wrap.gemini_recommendations %}
                <h3>Music and Style Recommendations</h3>
                <p>{{ wrap.gemini_recommendations }}</p>
            {% else %}
                <p>No recommendations available at this time.</p>
            {% endif %}
        </div>
    </section>
</div>

<!-- Navigation Dots -->
<div id="nav-dots" class="dot">
    {% for i in "0123456"|make_list %}
        <span class="dot" onclick="scrollToSlide({{ i }})"></span>
    {% endfor %}
</div>

<script src="{% static 'wrap_app/static/scroll.js' %}"></script>
{% endblock %}
